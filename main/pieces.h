/*
===============================================================================
  pieces.h — Définition centralisée des 7 pièces Tetris (AKA Edition)
-------------------------------------------------------------------------------
  Contient :
    - La matrice PIECES[7][4][4][4]
    - Les kicks SRS (JLSTZ + I)
    - piece_at() : accès simple
    - piece_color() : couleur associée
    - enum des pièces
===============================================================================
*/

#pragma once
#include <stdint.h>

// -----------------------------------------------------------------------------
//  Enum des pièces
// -----------------------------------------------------------------------------
enum {
    PIECE_I = 0,
    PIECE_O,
    PIECE_T,
    PIECE_S,
    PIECE_Z,
    PIECE_J,
    PIECE_L
};

// -----------------------------------------------------------------------------
//  Matrice des pièces (7 pièces × 4 rotations × 4×4)
// -----------------------------------------------------------------------------
static const int8_t PIECES[7][4][4][4] =
{
    // I
    {
        {{0,0,0,0},{1,1,1,1},{0,0,0,0},{0,0,0,0}},
        {{0,0,1,0},{0,0,1,0},{0,0,1,0},{0,0,1,0}},
        {{0,0,0,0},{1,1,1,1},{0,0,0,0},{0,0,0,0}},
        {{0,1,0,0},{0,1,0,0},{0,1,0,0},{0,1,0,0}}
    },

    // O
    {
        {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
        {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
        {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
        {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}}
    },

    // T
    {
        {{0,1,0,0},{1,1,1,0},{0,0,0,0},{0,0,0,0}},
        {{0,1,0,0},{0,1,1,0},{0,1,0,0},{0,0,0,0}},
        {{0,0,0,0},{1,1,1,0},{0,1,0,0},{0,0,0,0}},
        {{0,1,0,0},{1,1,0,0},{0,1,0,0},{0,0,0,0}}
    },

    // S
    {
        {{0,1,1,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
        {{0,1,0,0},{0,1,1,0},{0,0,1,0},{0,0,0,0}},
        {{0,0,0,0},{0,1,1,0},{1,1,0,0},{0,0,0,0}},
        {{1,0,0,0},{1,1,0,0},{0,1,0,0},{0,0,0,0}}
    },

    // Z
    {
        {{1,1,0,0},{0,1,1,0},{0,0,0,0},{0,0,0,0}},
        {{0,0,1,0},{0,1,1,0},{0,1,0,0},{0,0,0,0}},
        {{0,0,0,0},{1,1,0,0},{0,1,1,0},{0,0,0,0}},
        {{0,1,0,0},{1,1,0,0},{1,0,0,0},{0,0,0,0}}
    },

    // J
    {
        {{1,0,0,0},{1,1,1,0},{0,0,0,0},{0,0,0,0}},
        {{0,1,1,0},{0,1,0,0},{0,1,0,0},{0,0,0,0}},
        {{0,0,0,0},{1,1,1,0},{0,0,1,0},{0,0,0,0}},
        {{0,1,0,0},{0,1,0,0},{1,1,0,0},{0,0,0,0}}
    },

    // L
    {
        {{0,0,1,0},{1,1,1,0},{0,0,0,0},{0,0,0,0}},
        {{0,1,0,0},{0,1,0,0},{0,1,1,0},{0,0,0,0}},
        {{0,0,0,0},{1,1,1,0},{1,0,0,0},{0,0,0,0}},
        {{1,1,0,0},{0,1,0,0},{0,1,0,0},{0,0,0,0}}
    }
};

// -----------------------------------------------------------------------------
//  SRS kicks
// -----------------------------------------------------------------------------
static const int8_t SRS_JLSTZ[4][5][2] = {
    { { 0, 0}, {-1, 0}, {-1,+1}, { 0,-2}, {-1,-2} },
    { { 0, 0}, {+1, 0}, {+1,-1}, { 0,+2}, {+1,+2} },
    { { 0, 0}, {+1, 0}, {+1,+1}, { 0,-2}, {+1,-2} },
    { { 0, 0}, {-1, 0}, {-1,-1}, { 0,+2}, {-1,+2} }
};

static const int8_t SRS_I[4][5][2] = {
    { { 0, 0}, {-2, 0}, {+1, 0}, {-2,-1}, {+1,+2} },
    { { 0, 0}, {-1, 0}, {+2, 0}, {-1,+2}, {+2,-1} },
    { { 0, 0}, {+2, 0}, {-1, 0}, {+2,+1}, {-1,-2} },
    { { 0, 0}, {+1, 0}, {-2, 0}, {+1,-2}, {-2,+1} }
};

// -----------------------------------------------------------------------------
//  Accès simple
// -----------------------------------------------------------------------------
inline bool piece_at(int piece, int rot, int y, int x)
{
    return PIECES[piece][rot][y][x] != 0;
}
